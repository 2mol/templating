#schedules:
#- cron: 30 * * * *
#  displayName: Run every 30 minutes
#  branches:
#    include:
#    - /dev/bozturk/old-search-cache-pipeline
#  always: true

steps:
- checkout: git://internal/dotnet-templating@refs/heads/legacy/template-discovery-tool
- task: DotNetCoreCLI@2
  displayName: Build Cache Updater Tool
  inputs:
    command: 'build'
    projects: '$(Build.SourcesDirectory)/src/Microsoft.TemplateSearch.TemplateDiscovery/Microsoft.TemplateSearch.TemplateDiscovery.csproj'
- task: DotNetCoreCLI@2
  displayName: Run Cache Updater
  inputs:
    command: 'run'
    projects: '$(Build.SourcesDirectory)/src/Microsoft.TemplateSearch.TemplateDiscovery/Microsoft.TemplateSearch.TemplateDiscovery.csproj'
    arguments: '--basePath $(System.DefaultWorkingDirectory)/NugetDownloadDirectory'
- bash: mv -T '$(System.DefaultWorkingDirectory)/NugetDownloadDirectory/SearchCache/templateSearchInfo.json' '$(System.DefaultWorkingDirectory)/NugetDownloadDirectory/SearchCache/NuGetTemplateSearchInfo.json'
- publish: $(System.DefaultWorkingDirectory)/NugetDownloadDirectory/SearchCache/NuGetTemplateSearchInfo.json
  artifact: outputs